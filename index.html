<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>สั่งสินค้า | เพิ่มพูนทรัพย์วัสดุ 2009</title>
  <style>
    body{font-family:system-ui,TH Sarabun New,Arial;padding:16px;max-width:900px;margin:auto;line-height:1.6}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{border:1px solid #ddd;border-radius:12px;padding:12px}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    button{padding:8px 12px;border:1px solid #333;border-radius:10px;background:#fff;cursor:pointer}
    button.primary{background:#111;color:#fff}
    input,select{padding:8px;border:1px solid #ccc;border-radius:10px;width:100%}
    .cart{position:sticky;bottom:0;background:#fff;border-top:1px solid #eee;padding:12px;margin-top:16px}
    small{color:#666}
  </style>
</head>
<body>
  <header>
    <h1>เพิ่มพูนทรัพย์วัสดุ 2009</h1>
    <div>
      <a href="tel:0815464185"><button>โทร 081-546-4185</button></a>
      <a href="https://line.me/R/ti/p/@423gyrte"><button class="primary">แอดไลน์สั่งของ</button></a>
    </div>
  </header>

  <p>เลือกสินค้า ใส่จำนวน แล้วกด “สรุปคำสั่งซื้อ” เพื่อส่งรายการผ่าน LINE</p>

  <div class="row" style="margin:12px 0">
    <input id="q" placeholder="ค้นหาสินค้า เช่น ปูน ซีแพค อิฐ หิน ทราย เหล็ก สี สุขภัณฑ์" />
    <select id="cat">
      <option value="">หมวดทั้งหมด</option>
      <option>ปูน</option><option>อิฐ/บล็อก</option><option>เหล็ก</option>
      <option>ทราย/หิน</option><option>สี</option><option>สุขภัณฑ์</option>
      <option>ท่อ/ประปา</option><option>ฮาร์ดแวร์</option>
    </select>
  </div>

  <div id="list" class="grid"></div>

  <div class="cart" id="cartBox" style="display:none">
    <div id="cartItems"></div>
    <div class="row" style="margin-top:8px">
      <div><strong>รวม</strong> <span id="total">0</span> บาท <small id="count"></small></div>
      <div class="row" style="gap:6px">
        <button id="clear">ล้างตะกร้า</button>
        <button class="primary" id="checkout">สรุปคำสั่งซื้อ</button>
      </div>
    </div>
    <small>ที่อยู่จัดส่ง: 227 ม.2 ต.โนนหัน อ.ชุมแพ จ.ขอนแก่น | โทร 081-546-4185, 094-998-2691</small>
  </div>

<script>
const CATALOG = [
  {id:"CEM-CPAC-50", name:"ปูนซีเมนต์ CPAC Cement (ถุง 50 กก.)", price:1850, cat:"ปูน"},
  {id:"RB10", name:"เหล็ก RB10 (เส้น)", price:79, cat:"เหล็ก"},
  {id:"PIPE-PVC1", name:"ท่อ PVC ชั้น 8.5 ขนาด 1 นิ้ว (ท่อน)", price:79, cat:"ท่อ/ประปา"},
  {id:"BRICK-SOLID", name:"อิฐตัน (ก้อน)", price:1.8, cat:"อิฐ/บล็อก"},
  {id:"SAND", name:"ทรายก่อสร้าง (คิว)", price:650, cat:"ทราย/หิน"},
  {id:"STONE", name:"หินคลุก (คิว)", price:700, cat:"ทราย/หิน"},
  {id:"PAINT-ROOF", name:"สียะหลังคา 1 กล.", price:690, cat:"สี"},
  {id:"TOILET-SET", name:"ชุดสุขภัณฑ์ (ชุด)", price:2490, cat:"สุขภัณฑ์"},
  {id:"HW-HAMMER", name:"ค้อนช่าง (อัน)", price:129, cat:"ฮาร์ดแวร์"}
];

const el = (sel)=>document.querySelector(sel);
const list = el('#list');
const q = el('#q'); const cat = el('#cat');
const cartBox = el('#cartBox'); const cartItems = el('#cartItems');
const totalEl = el('#total'); const countEl = el('#count');
const clearBtn = el('#clear'); const checkoutBtn = el('#checkout');

let cart = JSON.parse(localStorage.getItem('cart')||'{}');

function format(n){return Number(n).toLocaleString('th-TH',{maximumFractionDigits:2});}

function renderList(){
  const term = (q.value||'').toLowerCase();
  const c = cat.value;
  list.innerHTML = '';
  CATALOG.filter(p=>{
    const okCat = !c || p.cat===c;
    const okTerm = !term || (p.name.toLowerCase().includes(term) || p.id.toLowerCase().includes(term));
    return okCat && okTerm;
  }).forEach(p=>{
    const qty = cart[p.id]?.qty||0;
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="row"><strong>${p.name}</strong><small>${p.id}</small></div>
      <div class="row"><small>หมวด: ${p.cat}</small><small>ราคา: ${format(p.price)} บาท/หน่วย</small></div>
      <div class="row" style="margin-top:8px">
        <button data-id="${p.id}" data-act="-">–</button>
        <div><strong id="qty-${p.id}">${qty}</strong> ชิ้น</div>
        <button data-id="${p.id}" data-act="+">+</button>
      </div>`;
    list.appendChild(div);
  });
}

function updateCartUI(){
  const ids = Object.keys(cart);
  cartBox.style.display = ids.length? 'block':'none';
  let total=0, cnt=0;
  cartItems.innerHTML = '';
  ids.forEach(id=>{
    const p = CATALOG.find(x=>x.id===id);
    if(!p) return;
    const qty = cart[id].qty;
    const line = document.createElement('div'); line.className='row';
    line.innerHTML = `<div>${p.name} × ${qty}</div><div>${format(p.price*qty)} บาท</div>`;
    cartItems.appendChild(line);
    total += p.price*qty; cnt += qty;
  });
  totalEl.textContent = format(total);
  countEl.textContent = `(ทั้งหมด ${cnt} ชิ้น)`;
  localStorage.setItem('cart', JSON.stringify(cart));
  // อัปเดตจำนวนในรายการสินค้า
  Object.keys(cart).forEach(id=>{
    const elQty = document.getElementById('qty-'+id);
    if(elQty) elQty.textContent = cart[id].qty;
  });
}

list.addEventListener('click', (e)=>{
  const b = e.target.closest('button'); if(!b) return;
  const id = b.dataset.id; const act = b.dataset.act;
  cart[id] = cart[id] || {qty:0};
  cart[id].qty += (act==='+')?1:-1;
  if(cart[id].qty<=0) delete cart[id];
  updateCartUI();
});

q.addEventListener('input', renderList);
cat.addEventListener('change', renderList);
clearBtn.addEventListener('click', ()=>{ cart={}; updateCartUI(); renderList(); });

checkoutBtn.addEventListener('click', ()=>{
  const ids = Object.keys(cart);
  if(!ids.length) return alert('ยังไม่มีสินค้าในตะกร้า');
  const lines = ids.map(id=>{
    const p = CATALOG.find(x=>x.id===id);
    return `- ${p.name} x ${cart[id].qty} = ${format(p.price*cart[id].qty)} บาท`;
  });
  const total = totalEl.textContent;
  const msg = encodeURIComponent(
    `สั่งซื้อจากหน้าเว็บ\n${lines.join('\n')}\nรวมทั้งสิ้น ${total} บาท\nชื่อ/ที่อยู่จัดส่ง: ______\nเบอร์โทร: ______`
  );
  window.location.href = `https://line.me/R/ti/p/@423gyrte?text=${msg}`;
});

renderList(); updateCartUI();
</script>
</body>
</html>

